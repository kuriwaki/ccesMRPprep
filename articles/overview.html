<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow Overview • ccesMRPprep</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Workflow Overview">
<meta property="og:description" content="ccesMRPprep">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ccesMRPprep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">Workflow Overview</a>
    </li>
    <li>
      <a href="../articles/acs.html">ACS Tables to Use for CCES and MRP</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/kuriwaki/ccesMRPprep/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Workflow Overview</h1>
            
      
      <small class="dont-index">Source: <a href="http://github.com/kuriwaki/ccesMRPprep/blob/master/vignettes/overview.Rmd"><code>vignettes/overview.Rmd</code></a></small>
      <div class="hidden name"><code>overview.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ccesMRPprep</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">haven</span>)</pre></body></html></div>
<div id="step-1--downloading-cces-data" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1--downloading-cces-data" class="anchor"></a><strong>Step 1.</strong> Downloading CCES data</h2>
<p>All CCES data can be downloaded directly from dataverse, using the development version of the <a href="https://github.com/IQSS/dataverse-client-r"><code>dataverse</code></a> R package. The function <code><a href="../reference/get_cces_dv.html">get_cces_dv()</a></code> will make this quick and simple - you only need to specify the name of the dataset, given in <code><a href="../reference/cces_dv_ids.html">?cces_dv_ids</a></code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># may take about 30 seconds to download</span>
<span class="no">ccc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_cces_dv.html">get_cces_dv</a></span>(<span class="st">"cumulative"</span>)</pre></body></html></div>
<p>We will use a built-in sample of 1,000 observations for illustration (see <code><a href="../reference/ccc_samp.html">ccc_samp()</a></code>).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ccc_samp</span>
<span class="co">#&gt; # A tibble: 1,000 x 18</span>
<span class="co">#&gt;     year case_id state st    cd    zipcode county_fips  gender   age    race</span>
<span class="co">#&gt;    &lt;int&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;int+l&gt; &lt;int&gt; &lt;int+l&gt;</span>
<span class="co">#&gt;  1  2006  439254 Neva… NV    NV-2  89703   32510       2 [Fem…    20 1 [Whi…</span>
<span class="co">#&gt;  2  2006  440689 Cali… CA    CA-2  96067   06093       2 [Fem…    71 1 [Whi…</span>
<span class="co">#&gt;  3  2006  445845 Colo… CO    CO-5  80922   08041       2 [Fem…    39 1 [Whi…</span>
<span class="co">#&gt;  4  2006  452572 Minn… MN    MN-5  55428   27053       1 [Mal…    74 1 [Whi…</span>
<span class="co">#&gt;  5  2006  498451 Iowa  IA    IA-2  50060   19185       2 [Fem…    53 1 [Whi…</span>
<span class="co">#&gt;  6  2006  502543 Tenn… TN    TN-5  37206   47037       2 [Fem…    50 1 [Whi…</span>
<span class="co">#&gt;  7  2006  523050 West… WV    WV-2  25312   54039       1 [Mal…    55 1 [Whi…</span>
<span class="co">#&gt;  8  2006  523861 Illi… IL    IL-3  60629   17031       2 [Fem…    51 1 [Whi…</span>
<span class="co">#&gt;  9  2006  532881 Minn… MN    MN-7  55396   27143       1 [Mal…    44 1 [Whi…</span>
<span class="co">#&gt; 10  2006  553375 Ohio  OH    OH-11 44112   39035       2 [Fem…    53 1 [Whi…</span>
<span class="co">#&gt; # … with 990 more rows, and 8 more variables: hispanic &lt;int+lbl&gt;,</span>
<span class="co">#&gt; #   educ &lt;int+lbl&gt;, faminc &lt;fct&gt;, marstat &lt;int+lbl&gt;, newsint &lt;int+lbl&gt;,</span>
<span class="co">#&gt; #   vv_turnout_gvm &lt;fct&gt;, voted_pres_16 &lt;fct&gt;, economy_retro &lt;int+lbl&gt;</span></pre></body></html></div>
</div>
<div id="step-2--cleaning-cces-data" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2--cleaning-cces-data" class="anchor"></a><strong>Step 2.</strong> Cleaning CCES data</h2>
<p>The CCES cumulative dataset is already harmonized and cleaned, but values must be recoded so that they later match with the values of the ACS. I have created key-value pairings for the main demographic variables. The wrapper function expects a CCES cumulative dataset and recodes.</p>
<p>See <code><a href="../reference/get_cces_question.html">get_cces_question()</a></code> for how to get the <em>outcome</em> data, which is a single column from another CCES dataset. This still relies on a flat file being pre-downloaded (via <code><a href="../reference/get_cces_dv.html">get_cces_dv()</a></code>).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ccc_std</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ccc_std_demographics.html">ccc_std_demographics</a></span>(<span class="no">ccc_samp</span>)</pre></body></html></div>
</div>
<div id="step-3--define-a-model-specification" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3--define-a-model-specification" class="anchor"></a><strong>Step 3.</strong> Define a Model Specification</h2>
<p>A formula represents the variables that are in the model, how they are interacted, and which variables are random effects. We presume the formula will be used in brms. Currently we support binary outcomes. This can be modeled as a binomial, which in brms is of the form</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">fm_brm</span> <span class="kw">&lt;-</span> <span class="no">yes</span> <span class="kw">|</span> <span class="fu">trials</span>(<span class="no">n_responses</span>) ~  <span class="no">age</span> + <span class="no">gender</span> + <span class="no">educ</span> + <span class="no">pct_trump</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">cd</span>)</pre></body></html></div>
<p>A prior could be specified here as well, but this is not strictly necessary and can be defined when fitting the model.</p>
</div>
<div id="step-4--collapsing-the-cces-data" class="section level2">
<h2 class="hasAnchor">
<a href="#step-4--collapsing-the-cces-data" class="anchor"></a><strong>Step 4.</strong> Collapsing the CCES data</h2>
<p>For speed, we collapse the individual-level data where each outcome is binary to a count dataset where each row is a cell (with a trial and success value). This form also makes drawing posteriors much easier in the next step. We use <code><a href="../reference/build_counts.html">build_counts()</a></code> for this, which takes a individual-level dataset (built from <code><a href="../reference/ccc_std_demographics.html">ccc_std_demographics()</a></code>, or further passed through <code><a href="../reference/cces_join_slim.html">cces_join_slim()</a></code> for all relevant outcomes and predictors).</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># fake outcome data - must be called "response"</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">02138</span>)
<span class="no">ccc_samp_std</span> <span class="kw">&lt;-</span> <span class="no">ccc_samp</span> <span class="kw">%&gt;%</span>
   <span class="fu">mutate</span>(<span class="kw">response</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"For"</span>, <span class="st">"Against"</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fu">n</span>(), <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>)) <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/ccc_std_demographics.html">ccc_std_demographics</a></span>()

<span class="no">ccc_samp_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/build_counts.html">build_counts</a></span>(<span class="no">ccc_samp_std</span>,
                             <span class="st">"yes | trials(n_response) ~ age + gender + educ"</span>)

<span class="no">ccc_samp_out</span>
<span class="co">#&gt; # A tibble: 400 x 5</span>
<span class="co">#&gt;      age gender educ         n_response   yes</span>
<span class="co">#&gt;    &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;             &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    18 Male   HS or Less            3     0</span>
<span class="co">#&gt;  2    18 Female HS or Less            7     5</span>
<span class="co">#&gt;  3    18 Female Some College          1     0</span>
<span class="co">#&gt;  4    19 Male   HS or Less            1     1</span>
<span class="co">#&gt;  5    19 Female HS or Less            2     1</span>
<span class="co">#&gt;  6    19 Female Some College          2     1</span>
<span class="co">#&gt;  7    20 Male   HS or Less            1     0</span>
<span class="co">#&gt;  8    20 Male   Some College          5     3</span>
<span class="co">#&gt;  9    20 Female HS or Less            3     2</span>
<span class="co">#&gt; 10    20 Female Some College          5     4</span>
<span class="co">#&gt; # … with 390 more rows</span></pre></body></html></div>
</div>
<div id="step-5--prepare-acs-data-and-poststratification-table" class="section level2">
<h2 class="hasAnchor">
<a href="#step-5--prepare-acs-data-and-poststratification-table" class="anchor"></a><strong>Step 5.</strong> Prepare ACS data and Poststratification Table</h2>
<p>We provide wrappers around the great <a href="https://walker-data.com/tidycensus/">tidycensus</a> package that produces ACS data and post-stratification tables from the ACS. A considerable amount of lookup tables internally will pull out the appropriate CD-level counts and label them so that they match up with CCES keys. District-level information, which is not necessary ACS data (e.g. election outcomes) must be supplied here as well/</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
 <span class="no">acs_tab</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_acs_cces.html">get_acs_cces</a></span>(
              <span class="kw">varlist</span> <span class="kw">=</span> <span class="no">acscodes_age_sex_educ</span>,
              <span class="kw">varlab_df</span> <span class="kw">=</span> <span class="no">acscodes_df</span>,
             <span class="kw">year</span> <span class="kw">=</span> <span class="fl">2018</span>)

 <span class="no">poststrat</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="../reference/get_poststrat.html">get_poststrat</a></span>(<span class="no">acs_tab</span>, <span class="no">cd_info_2018</span>, <span class="no">fm_brm</span>)</pre></body></html></div>
</div>
<div id="final-output" class="section level2">
<h2 class="hasAnchor">
<a href="#final-output" class="anchor"></a><strong>Final Output</strong>
</h2>
<p>Under this workflow, only three objects are needed to conduct MRP with a brms model:</p>
<ol style="list-style-type: decimal">
<li>The model specification which can be a plain text line of a brms formula (in Step 3)</li>
<li>The survey data that is formatted via <code><a href="../reference/build_counts.html">build_counts()</a></code> at the end (in Step 4)</li>
<li>The poststratification table via <code><a href="../reference/get_poststrat.html">get_poststrat()</a></code> (in Step 5).</li>
</ol>
<p>Together, these uniquely define one MRP model for one operationalization of one question with a particular set of covariates.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.shirokuriwaki.com">Shiro Kuriwaki</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
