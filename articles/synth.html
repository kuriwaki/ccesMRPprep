<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Synthetic Target Estimation • ccesMRPprep</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Synthetic Target Estimation">
<meta property="og:description" content="ccesMRPprep">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ccesMRPprep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">Workflow Overview</a>
    </li>
    <li>
      <a href="../articles/derived.html">Deriving Variables from Question Metadata</a>
    </li>
    <li>
      <a href="../articles/acs.html">ACS Tables for CCES and MRP</a>
    </li>
    <li>
      <a href="../articles/cps.html">CPS Overview</a>
    </li>
    <li>
      <a href="../articles/synth.html">Synthetic Target Estimation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/kuriwaki/ccesMRPprep/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="synth_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Synthetic Target Estimation</h1>
            
      
      <small class="dont-index">Source: <a href="http://github.com/kuriwaki/ccesMRPprep/blob/master/vignettes/synth.Rmd"><code>vignettes/synth.Rmd</code></a></small>
      <div class="hidden name"><code>synth.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.github.com/kuriwaki/ccesMRPprep">ccesMRPprep</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span>
<span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></code></pre></div>
<p>Almost all survey weighting, whether MRP or not, face a data limitation that direct knowledge of the joint distributions of predictors (such as race, partisanship, and geography) are limited. There is a long tradition of statistical and applied work that can be grouped under the umbrella of synthetic population imputation: it seeks to expand the set of available interactions to poststratify on. The core idea has parallels in iterative proportional fitting (Deming and Stephan), ecological inference, and latent factorization methods.</p>
<p>We can classify the main approaches by what outside data they leverage:</p>
<table class="table">
<thead><tr class="header">
<th>Main Idea</th>
<th>Functions</th>
<th>Examples</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Use Population Margins</td>
<td><code><a href="../reference/synth_prod.html">synth_prod()</a></code></td>
<td>Leemann and Wasserfallen (2017)</td>
</tr>
<tr class="even">
<td>Use Microdata</td>
<td><code><a href="../reference/synth_mlogit.html">synth_mlogit()</a></code></td>
<td>Kastellec et al. (2015)</td>
</tr>
<tr class="odd">
<td>Combine both</td>
<td><code><a href="../reference/synth_mlogit.html">synth_smoothfix()</a></code></td>
<td>Ghitza and Steiz (2020)</td>
</tr>
<tr class="even">
<td></td>
<td><code><a href="../reference/synth_bmlogit.html">synth_bmlogit()</a></code></td>
<td>Yamauchi (2021)</td>
</tr>
</tbody>
</table>
<div id="validation-of-multiple-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#validation-of-multiple-methods" class="anchor"></a>Validation of Multiple Methods</h2>
<p>We provide a simple set of functions to implement this. We extend the ACS table assisted by a survey model using a function called <code><a href="../reference/synth_mlogit.html">synth_mlogit()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acs_syn_mlogit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synth_mlogit.html">synth_mlogit</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">female</span> <span class="op">+</span> <span class="va">age</span>,
                               microdata <span class="op">=</span> <span class="va">cc18_NY</span>,
                               poptable <span class="op">=</span> <span class="va">acs_race_NY</span>,  
                               area_var <span class="op">=</span> <span class="st">"cd"</span><span class="op">)</span></code></pre></div>
<p>The ccesMRPprep package provide two other approaches to estimating the joint – these incorporate another source of information, which is the margins that are available.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">race_margins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_table.html">collapse_table</a></span><span class="op">(</span><span class="va">acs_race_NY</span>, area_var <span class="op">=</span> <span class="st">"cd"</span>, X_vars <span class="op">=</span> <span class="st">"race"</span>, 
                               count_var <span class="op">=</span> <span class="st">"count"</span>, new_name <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>
<span class="va">race_margins</span>
<span class="co">#&gt; # A tibble: 162 x 3</span>
<span class="co">#&gt;    cd    race             count</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;fct&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 NY-01 White           427756</span>
<span class="co">#&gt;  2 NY-01 Black            31440</span>
<span class="co">#&gt;  3 NY-01 Hispanic         76067</span>
<span class="co">#&gt;  4 NY-01 Asian            25671</span>
<span class="co">#&gt;  5 NY-01 Native American      0</span>
<span class="co">#&gt;  6 NY-01 All Other        15365</span>
<span class="co">#&gt;  7 NY-02 White           366313</span>
<span class="co">#&gt;  8 NY-02 Black            52312</span>
<span class="co">#&gt;  9 NY-02 Hispanic        116653</span>
<span class="co">#&gt; 10 NY-02 Asian            17395</span>
<span class="co">#&gt; # … with 152 more rows</span></code></pre></div>
<p>Given this data that is simply the marginal distribution of race in each CD, one option is to simply take the product assuming independence</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acs_syn_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synth_prod.html">synth_prod</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">female</span> <span class="op">+</span> <span class="va">age</span>,
                           poptable <span class="op">=</span> <span class="va">acs_race_NY</span>,
                           newtable <span class="op">=</span> <span class="va">race_margins</span>,
                           area_var <span class="op">=</span> <span class="st">"cd"</span><span class="op">)</span></code></pre></div>
<p>A more sophisticated method is to combine these two sources of information: microdata and known outcome margins. Ghitza and Steitz did a two-step process, where they first did survey modeling to smooth cells and then fixed <em>those</em> margins to the known population margins.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acs_syn_fix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synth_mlogit.html">synth_smoothfix</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">female</span> <span class="op">+</span> <span class="va">age</span>, 
                               microdata <span class="op">=</span> <span class="va">cc18_NY</span>,
                               poptable <span class="op">=</span> <span class="va">acs_race_NY</span>, 
                               fix_to <span class="op">=</span> <span class="va">race_margins</span>,
                               area_var <span class="op">=</span> <span class="st">"cd"</span><span class="op">)</span></code></pre></div>
<p>Yamauchi <a href="https://github.com/soichiroy/bmlogit">developed</a> a multinomial logit that simultaneously imposes the same sort of balancing constraint. The benefit of this method is that the constraint is applied simultaneously with the estimation: the rake weighting does not nullify the survey data, and the tolerance range can be controlled.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acs_syn_fix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synth_bmlogit.html">synth_bmlogit</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">female</span> <span class="op">+</span> <span class="va">age</span>, 
                               microdata <span class="op">=</span> <span class="va">cc18_NY</span>,
                               poptable <span class="op">=</span> <span class="va">acs_race_NY</span>, 
                               fix_to <span class="op">=</span> <span class="va">race_margins</span>,
                               area_var <span class="op">=</span> <span class="st">"cd"</span><span class="op">)</span></code></pre></div>
<p>The benefit of this example is that we can examine how our estimated counts of this synthetic table compared with the actual values of the joint distribution. Here is a scatter plot comparing the counts. Each point represents a cell: [14 congressional districts] x [2 gender categories] x [5 age categories] x [6 race categories].</p>
<p><img src="synth_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>The first plot does not look great. The simple product does surprisingly well. It is after all perhaps not surprising that it is hard to estimate education from age bins and gender. The main difference seems to be that in all the other three cases, we are fixing outcomes to <em>CD-level</em> education margins. <code><a href="../reference/synth_bmlogit.html">synth_bmlogit()</a></code> would do worse, for example, if we only fixed to the less granular <em>State-level</em> margins.</p>
</div>
<div id="real-applications" class="section level2">
<h2 class="hasAnchor">
<a href="#real-applications" class="anchor"></a>Real Applications</h2>
<p>We have a age x gender x education table and a age x gender x race table, but not a four-way table. Here, we use the synthetic estimators to estimate this joint table.</p>
<p>We know the margins of education in each congressional district in NY:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">educ_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">acs_educ_NY</span>, <span class="va">cd</span>, <span class="va">educ</span>, wt <span class="op">=</span> <span class="va">count</span>, name <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>
<span class="va">educ_target</span>
<span class="co">#&gt; # A tibble: 108 x 3</span>
<span class="co">#&gt;    cd    educ          count</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;fct&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt;  1 NY-01 HS or Less   202298</span>
<span class="co">#&gt;  2 NY-01 Some College 169556</span>
<span class="co">#&gt;  3 NY-01 4-Year       111561</span>
<span class="co">#&gt;  4 NY-01 Post-Grad     83255</span>
<span class="co">#&gt;  5 NY-02 HS or Less   231614</span>
<span class="co">#&gt;  6 NY-02 Some College 157090</span>
<span class="co">#&gt;  7 NY-02 4-Year        99763</span>
<span class="co">#&gt;  8 NY-02 Post-Grad     71094</span>
<span class="co">#&gt;  9 NY-03 HS or Less   138929</span>
<span class="co">#&gt; 10 NY-03 Some College 127003</span>
<span class="co">#&gt; # … with 98 more rows</span></code></pre></div>
<p>Unfortunately, these will be collapsed statewide for now.</p>
<p>For bmlogit and mlogit</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># No constraint</span>
<span class="va">pop_svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synth_mlogit.html">synth_mlogit</a></span><span class="op">(</span><span class="va">educ</span> <span class="op">~</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span>,
                        microdata <span class="op">=</span> <span class="va">cc18_NY</span>,
                        poptable <span class="op">=</span> <span class="va">acs_race_NY</span>,
                        area_var <span class="op">=</span> <span class="st">"cd"</span><span class="op">)</span>

<span class="co"># With constraint</span>
<span class="va">pop_bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synth_bmlogit.html">synth_bmlogit</a></span><span class="op">(</span><span class="va">educ</span> <span class="op">~</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span>,
                        microdata <span class="op">=</span> <span class="va">cc18_NY</span>,
                        fix_to <span class="op">=</span> <span class="va">educ_target</span>,
                        poptable <span class="op">=</span> <span class="va">acs_race_NY</span>,
                        area_var <span class="op">=</span> <span class="st">"cd"</span><span class="op">)</span></code></pre></div>
<p>Here we show the main estimates of the model, which are conditional probability given X strata. We fix to women and a CD, <code>NY-01</code> which is the tip of Long Island, New York (Lee Zeldin, R; 70% White). The CD does not matter as long as the targets are at the state level the CDs do not matter.</p>
<p><img src="synth_files/figure-html/unnamed-chunk-10-1.png" width="595.2"></p>
<p><img src="synth_files/figure-html/unnamed-chunk-11-1.png" width="595.2"></p>
<p>Recall that bmlogit balances to the <em>area</em> level population targets if available, whereas there is no balancing in the mlogit, and both always use the entire microdata without subsetting to area. So, the values should be somewhat different if subsetting to a different CD, like NY-14 (D, Ocasio-Cortez) where 49% of the population is Hispanic.</p>
<p><img src="synth_files/figure-html/unnamed-chunk-12-1.png" width="595.2"></p>
<p>Whereas the values would be the same regardless of district in the mlogit implementation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.shirokuriwaki.com">Shiro Kuriwaki</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '1a2c0d939f9a70090cf27efbbac5ba52',
    indexName: 'ccesmrpprep',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
