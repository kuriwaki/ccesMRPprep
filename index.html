<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Functions to Prepare CCES data for MRP • ccesMRPprep</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Functions to Prepare CCES data for MRP">
<meta property="og:description" content="This provides data loading, processing, and formatting functions for
   a particular task: using CCES data for Multilevel Regression Post-stratification.
   Model fitting and visualization of MRP itself is handled elsewhere. This package
   is focused on the preparation to get there. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ccesMRPprep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/acs.html">ACS Tables to Use for CCES and MRP</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/kuriwaki/ccesMRPprep/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="portable-routines-for-preparing-cces-and-acs-data-for-mrp" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#portable-routines-for-preparing-cces-and-acs-data-for-mrp" class="anchor"></a>Portable Routines for Preparing CCES and ACS data for MRP</h1></div>
<p>Cite as:</p>
<ul>
<li>Shiro Kuriwaki (2020). ccesMRPprep: Functions to Prepare CCES data for MRP. R package. <a href="https://www.github.com/kuriwaki/ccesMRPprep" class="uri">https://www.github.com/kuriwaki/ccesMRPprep</a>
</li>
</ul>
<div id="purpose-and-contribution" class="section level3">
<h3 class="hasAnchor">
<a href="#purpose-and-contribution" class="anchor"></a>Purpose and Contribution</h3>
<p>Multi-level Regression and Post-stratification is an increasingly popular method for analyzing surveys, and can be implemented on public datasets such as the <a href="https://cces.gov.harvard.edu/">CCES</a> and ACS. However, there are considerable upfront costs in preparing the data, recoding values and generating post-stratification frames so data can be matched.</p>
<p>This package provides data loading, processing, and formatting functions for a particular task: using <em>CCES data</em> for MRP. Its key contributions are functions that are calibrated to a consistent syntax, lookup tables and value-key pairs of data that are based upon a careful reading of data sources, and data loading functions that use APIs to reduce the dependency on downloading large files. Model fitting and visualization of MRP itself is handled elsewhere. This package is focused on the preparation to get there.</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># remotes::install_github("kuriwaki/ccesMRPprep")</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ccesMRPprep</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)</pre></div>
<p>See the vignettes for more long-form documentation and explanation of the nature of the data. Otherwise, each function and built-in data provides documentation as well. An overview of the workflow is below.</p>
</div>
<div id="workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h2>
<p><em>Step 1. Loading CCES data</em></p>
<p>All CCES data can be downloaded directly from dataverse, using the development version of the <code>dataverse</code> R package. Once you set your dataverse API token, the function <code>get_cces_dv</code> will make this quick and simple.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="no">ccc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/get_cces_dv.html">get_cces_dv</a></span>(<span class="st">"cumulative"</span>)</pre></div>
<p>We will use a built-in sample of 1,000 observations for illustration (see <code><a href="reference/ccc_samp.html">?ccc_samp</a></code>).</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">ccc_samp</span></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## # A tibble: 1,000 x 17</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">##     year case_id state st    cd    zipcode county_fips   age    race hispanic</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">##    &lt;int&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;int&gt; &lt;int+l&gt; &lt;int+lb&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">##  1  2006  439254 Neva… NV    NV-2  89703   32510          20 1 [Whi…       NA</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">##  2  2006  440689 Cali… CA    CA-2  96067   06093          71 1 [Whi…       NA</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">##  3  2006  445845 Colo… CO    CO-5  80922   08041          39 1 [Whi…       NA</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">##  4  2006  452572 Minn… MN    MN-5  55428   27053          74 1 [Whi…       NA</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">##  5  2006  498451 Iowa  IA    IA-2  50060   19185          53 1 [Whi…       NA</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">##  6  2006  502543 Tenn… TN    TN-5  37206   47037          50 1 [Whi…       NA</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">##  7  2006  523050 West… WV    WV-2  25312   54039          55 1 [Whi…       NA</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">##  8  2006  523861 Illi… IL    IL-3  60629   17031          51 1 [Whi…       NA</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">##  9  2006  532881 Minn… MN    MN-7  55396   27143          44 1 [Whi…       NA</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">## 10  2006  553375 Ohio  OH    OH-11 44112   39035          53 1 [Whi…       NA</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">## # … with 990 more rows, and 7 more variables: educ &lt;int+lbl&gt;, faminc &lt;fct&gt;,</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">## #   marstat &lt;int+lbl&gt;, newsint &lt;int+lbl&gt;, vv_turnout_gvm &lt;fct&gt;,</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">## #   voted_pres_16 &lt;fct&gt;, economy_retro &lt;int+lbl&gt;</span></span></code></pre></div>
<p><em>Step 2. Cleaning CCES data</em></p>
<p>The CCES cumulative dataset is already harmonized and cleaned, but values must be recoded so that they later match with the values of th ACS. I have created key-value pairings for the main demographic variables. The wrapper function expects a CCES cumulative dataset and recodes.</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="no">ccc_std</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/ccc_std_demographics.html">ccc_std_demographics</a></span>(<span class="no">ccc_samp</span>)</pre></div>
<p><em>Step 3. Collapsing the CCES data</em></p>
<p><em>Step 4. Preparing the brms function</em></p>
<p><em>Step 5. Cleaning and preparing the ACS data</em></p>
<p>We provide wrappers around the great <a href="https://walker-data.com/tidycensus/">tidycensus</a> package that produces ACS data and post-stratification tables from the ACS. A considerable amount of lookup tables internally will pull out the apporpriate CD-level counts and label them so that they match up with CCES keys.</p>
<div class="sourceCode" id="cb6"><pre class="r"> <span class="no">fm_brm</span> <span class="kw">&lt;-</span> <span class="no">yes</span> <span class="kw">|</span> <span class="fu">responses</span>(<span class="no">n_cell</span>) ~  <span class="no">age</span> + <span class="no">gender</span> + <span class="no">educ</span> + <span class="no">pct_trump</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">cd</span>)


 <span class="no">acs_tab</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/get_acs_cces.html">get_acs_cces</a></span>(
              <span class="kw">varlist</span> <span class="kw">=</span> <span class="no">acscodes_age_sex_educ</span>,
              <span class="kw">varlab_df</span> <span class="kw">=</span> <span class="no">acscodes_df</span>,
             <span class="kw">.year</span> <span class="kw">=</span> <span class="fl">2018</span>)

 <span class="no">poststrat</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="reference/get_poststrat.html">get_poststrat</a></span>(<span class="no">acs_tab</span>, <span class="no">cd_info_2018</span>, <span class="no">fm_brm</span>)</pre></div>
<div id="related-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#related-packages" class="anchor"></a>Related Packages</h3>
<ul>
<li>
<a href="https://github.com/kuriwaki/rcces" class="uri">https://github.com/kuriwaki/rcces</a> has another set of CCES related functions, but these are either my own personal functions in development (not for production), or specific to non-MRP projects.</li>
<li>
<a href="https://github.com/kuriwaki/CCES_district-opinion" class="uri">https://github.com/kuriwaki/CCES_district-opinion</a> is a private package that uses (among others) this package to process large CCES data for MRP at scale.</li>
</ul>
</div>
<div id="support" class="section level3">
<h3 class="hasAnchor">
<a href="#support" class="anchor"></a>Support</h3>
<p>This package is a part of the CCES MRP project, supported by NSF Grant 1926424: <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1926424">Bayesian analytical tools to improve survey estimates for subpopulations and small areas</a>. The contents are based on collaborations and helpful discussions with Ben Bales, Lauren Kennedy, Mitzi Morris, and Soichiro Yamauchi.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="http://github.com/kuriwaki/ccesMRPprep/">http://​github.com/​kuriwaki/​ccesMRPprep/​</a>
</li>
<li>Report a bug at <br><a href="http://github.com/kuriwaki/ccesMRPprep/issues">http://​github.com/​kuriwaki/​ccesMRPprep/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.shirokuriwaki.com">Shiro Kuriwaki</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5687-2647" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.shirokuriwaki.com">Shiro Kuriwaki</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
